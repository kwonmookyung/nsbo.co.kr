<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        input[type="submit"].fit,
        input[type="reset"].fit,
        input[type="button"].fit,
        button.fit,
        .button.fit {
            width: 100%;
        }

        input[type="submit"].small,
        input[type="reset"].small,
        input[type="button"].small,
        button.small,
        .button.small {
            font-size: 0.8em;
        }

        /* ë°°ë„ˆ ìŠ¬ë¼ì´ë“œìš© */
        .slider-container {
            position: relative;
            width: 100%;
            margin: auto;
            overflow: hidden;
        }

        .slide {
            display: none;
            position: relative;
            /* ë¶€ëª¨ê°€ ë†’ì´ ê°ì§€í•˜ê²Œ í•¨ */
        }

        .slide img {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            display: block;
        }

        /* ë°°ë„ˆì™€ í—¤ë” ê²¹ì¹¨ ë°©ì§€ + ì•„ë˜ ì½˜í…ì¸  ì—¬ìœ  */
        #banner {
            margin-top: 80px;
            margin-bottom: 4em;
            position: relative;
            z-index: 1;
        }

        .fade {
            animation-name: fade;
            animation-duration: 1s;
        }

        @keyframes fade {
            from {
                opacity: 0.4;
            }

            to {
                opacity: 1;
            }
        }

        .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: #000000;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .dot.active {
            background-color: #ffffff;
        }

        .dots-container {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 100%;
            z-index: 10;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘: AppBar ìˆ¨ê¸°ê³  ì—¬ë°± ì¡°ì • */
        #mobile-logo {
            display: none;
            position: fixed;
            top: 1em;
            left: 1em;
            font-size: 1.2em;
            font-weight: bold;
            color: #000 !important;
            text-decoration: none;
            z-index: 2000;
            background: white;
            padding: 0.3em 0.6em;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        @media screen and (max-width: 3840px) and (min-width: 1024px) {
            .wrapper.style1 {
                padding-top: 6em !important;
            }
        }

        @media screen and (max-width: 1024px) {
            #header {
                display: none !important;
            }

            .dots-container {
                bottom: 15px;
            }

            #banner {
                margin-bottom: 6em;
                /* ì—¬ìœ  ìˆê²Œ */
            }

            #mobile-logo {
                display: block !important;
            }

            #logo,
            #logo img {
                display: none !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* í˜¹ì‹œ ë‹¤ë¥¸ ìœ„ì¹˜ì—ì„œ logo.jpgê°€ ë¶ˆë ¤ì˜¤ëŠ” ê²ƒê¹Œì§€ ì œê±° */
            img[src*="logo.jpg"] {
                display: none !important;
            }
        }

        @media screen and (max-width: 1024px) {
            #banner {
                margin-bottom: 1em !important;
            }

            .wrapper.style1 {
                padding-top: 1em !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* .box.highlight ì „ì²´ë¥¼ ì™¼ìª½ ì •ë ¬ë¡œ ë¶™ì´ê¸° */
            .box.highlight {
                text-align: left !important;
                margin-left: 0 !important;
                padding-left: 0 !important;
            }

            /* ì „ì²´ ì»¨í…Œì´ë„ˆ ì—¬ë°± ì¤„ì´ê¸° */
            .wrapper.style1>.container {
                padding-left: 3em !important;
                padding-right: 1em !important;
            }

            /* ë‚´ë¶€ col ì„¹ì…˜ì˜ ì—¬ë°±ë„ ìµœì†Œí™” */
            .row.gtr-200>section {
                padding-left: 0 !important;
                padding-right: 0 !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* í•˜ì´ë¼ì´íŠ¸ ë°•ìŠ¤ ì•ˆìª½ í…ìŠ¤íŠ¸ ì™¼ìª½ ì •ë ¬ */
            .box.highlight {
                text-align: left !important;
            }


            /* ì•„ì´ì½˜ ìœ„ì¹˜ë„ ì™¼ìª½ìœ¼ë¡œ */
            .box.highlight .icon {
                margin: 0 0 1em 0;
                display: inline-block;
                float: left;
            }

            .box.highlight h3,
            .box.highlight p {
                margin-left: 6em;
                /* ì•„ì´ì½˜ ì˜†ìœ¼ë¡œ ë°€ê¸° (ì ì ˆíˆ ì¡°ì • ê°€ëŠ¥) */
            }
        }

        #login-wrapper {
            margin-top: 120px;
            text-align: center;
            padding: 3em 1em;
        }

        #login-wrapper h2 {
            font-size: 2em;
            margin-bottom: 1em;
        }

        .kakao-button {
            background-color: #FEE500;
            color: #000;
            font-weight: bold;
            border: none;
            padding: 1em 2em;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .kakao-button:hover {
            background-color: #f2d900;
        }

        @media screen and (max-width: 768px) {
            #login-wrapper {
                padding: 2em 1em;
            }
        }
    </style>
</head>

<body class="is-preload">
    <div id="page-wrapper">

        <!-- Header (í™ˆí˜ì´ì§€ì™€ ë™ì¼í•œ ê³ ì • í—¤ë” êµ¬ì„±) -->
        <div id="header" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2em;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    ">
            <div>
                <a href="index.html" id="logo">
                    <img src="images/logo.jpg" alt="ì°©í•œì†Œìƒê³µì¸ì§€ì›ë§ˆì¼“ ë¡œê³ " style="height: 80px;">
                </a>
            </div>
            <nav id="nav">
                <ul>
                    <li class="current"><a href="kakao-login.html" style="font-size: 0.85em;">ë¡œê·¸ì¸</a></li>
                    <li><a href="mypage.html" style="font-size: 0.85em;">ë§ˆì´í˜ì´ì§€</a></li>
                    <li></li><a href="index.html">í™ˆ</a></li>
                    <li> <a href="brand.html">ë¸Œëœë“œ</a>
                        <ul>
                            <li><a href="brand.html#company-intro">íšŒì‚¬ì†Œê°œ</a></li>
                            <li><a href="brand.html#ci">íšŒì‚¬CI</a></li>
                            <li><a href="brand.html#culture">ê¸°ì—…ë¬¸í™”</a></li>
                            <li><a href="brand.html#sustainability">ì§€ì†ê°€ëŠ¥ê²½ì˜</a></li>
                            <li><a href="brand.html#roadmap">ë¡œë“œë§µ</a></li>
                        </ul>
                    </li>
                    <li><a href="left-sidebar.html">ì†”ë£¨ì…˜</a></li>
                    <li><a href="right-sidebar.html">í”„ë¡œê·¸ë¨</a></li>
                    <li><a href="two-sidebar.html">ê³ ê°ë¬¸ì˜</a></li>
                    <li><a href="no-sidebar.html">ì°©ì†Œë§ˆì¼“</a></li>
                </ul>
            </nav>
        </div>

        <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
        <section id="login-wrapper">
            <h2>ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì…</h2>
            <p>ì¹´ì¹´ì˜¤í†¡ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
            <a href="#" onclick="loginWithKakao(); return false;">
                <button class="kakao-button">ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button>
            </a>
        </section>
    </div>

    <!-- í•„ìˆ˜ JSë“¤ -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- âœ… ì¹´ì¹´ì˜¤ & Firebase SDK -->
    <!-- ê¸°ì¡´ Firebase SDK v8 ëŒ€ì‹  ëª¨ë“ˆ ë°©ì‹ v11.6.1ë¡œ ë³€ê²½ -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        let app, db, auth;
        let isFirebaseReady = false;

        // ëª¨ë‹¬ UI í•¨ìˆ˜ (ê¸°ì¡´ alert ëŒ€ì‹  ì‚¬ìš©)
        function showModal(message) {
            // ì´ íŒŒì¼ì—ëŠ” ëª¨ë‹¬ UIê°€ ì—†ìœ¼ë¯€ë¡œ console.errorë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
            // ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ì—ì„œëŠ” UIë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
            console.error(message);
        }

        // Firebase ì´ˆê¸°í™” ë° ì¸ì¦
        async function setupFirebase() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    // ğŸ’¡ onAuthStateChangedë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ìƒíƒœ ë³€ê²½ì„ ê°ì§€í•©ë‹ˆë‹¤.
                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            console.log("âœ… Firebase ì¸ì¦ ì™„ë£Œ. User ID:", user.uid);
                            isFirebaseReady = true;
                        } else {
                            // ğŸ’¡ ì¸ì¦ì´ ë˜ì§€ ì•Šì€ ê²½ìš° ìµëª… ë¡œê·¸ì¸ ì‹œë„
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        }
                    });
                } else {
                    console.error("âŒ Firebase ì„¤ì •ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            } catch (error) {
                console.error("âŒ Firebase ì´ˆê¸°í™” ë˜ëŠ” ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜:", error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì´ˆê¸°í™” ë° ì¸ì¦ ì‹œì‘
        window.onload = function () {
            setupFirebase();
            Kakao.init("cc58d703cacde86ff1976fd723a04854");
            console.log("âœ… ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” ì™„ë£Œ");
        };

        function loginWithKakao() {
            // ğŸ’¡ Firebaseê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!isFirebaseReady) {
                showModal("ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
                return;
            }

            localStorage.setItem("loginSource", "login"); // ê²½ë¡œ ì €ì¥

            Kakao.Auth.login({
                success: function (authObj) {
                    Kakao.API.request({
                        url: '/v2/user/me',
                        success: function (res) {
                            const kakaoId = res.id;
                            const account = res.kakao_account;

                            // â— ì˜¤ë¥˜ í•´ê²°: account ê°ì²´ ì•ˆì— name í•„ë“œê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì•ˆì „í•˜ê²Œ ì ‘ê·¼
                            const userData = {
                                name: account?.name || null,
                                gender: account?.gender || null,
                                age_range: account?.age_range || null,
                                birthday: account?.birthday || null,
                                phone_number: account?.phone_number || null,
                                timestamp: serverTimestamp() // Firebase v11ìš© serverTimestampë¡œ ë³€ê²½
                            };

                            // âœ… Firestore ê²½ë¡œ ìˆ˜ì •: ë³´ì•ˆ ê·œì¹™ì— ë§ê²Œ ë³€ê²½
                            const usersCollectionRef = doc(db, `/artifacts/${appId}/public/data/users`, kakaoId.toString());

                            getDoc(usersCollectionRef).then((docSnap) => {
                                if (docSnap.exists) {
                                    console.log("âœ… ê¸°ì¡´ ì‚¬ìš©ì - Firestore ì €ì¥ ìƒëµ");
                                    window.location.href = "kakao-login-success.html";
                                } else {
                                    // âŒ ì—†ìœ¼ë©´ ì €ì¥ í›„ ì´ë™
                                    setDoc(usersCollectionRef, userData)
                                        .then(() => {
                                            console.log("âœ… Firestore ì €ì¥ ì™„ë£Œ");
                                            window.location.href = "kakao-login-success.html";
                                        })
                                        .catch((error) => {
                                            console.error("âŒ Firestore ì €ì¥ ì‹¤íŒ¨:", error);
                                            showModal("íšŒì›ê°€ì… ì €ì¥ ì‹¤íŒ¨");
                                        });
                                }
                            }).catch((err) => {
                                console.error("âŒ Firestore ë¬¸ì„œ í™•ì¸ ì‹¤íŒ¨:", err);
                                showModal("ì„œë²„ ì˜¤ë¥˜: ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                            });
                        },
                        fail: function (error) {
                            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:", error);
                            showModal("ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨");
                        }
                    });
                },
                fail: function (err) {
                    console.error("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:", err);
                    showModal("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨");
                }
            });
        }
    </script>
</body>

</html>

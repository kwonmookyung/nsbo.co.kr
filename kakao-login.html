<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        input[type="submit"].fit,
        input[type="reset"].fit,
        input[type="button"].fit,
        button.fit,
        .button.fit {
            width: 100%;
        }

        input[type="submit"].small,
        input[type="reset"].small,
        input[type="button"].small,
        button.small,
        .button.small {
            font-size: 0.8em;
        }

        /* ë°°ë„ˆ ìŠ¬ë¼ì´ë“œìš© */
        .slider-container {
            position: relative;
            width: 100%;
            margin: auto;
            overflow: hidden;
        }

        .slide {
            display: none;
            position: relative;
            /* ë¶€ëª¨ê°€ ë†’ì´ ê°ì§€í•˜ê²Œ í•¨ */
        }

        .slide img {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            display: block;
        }

        /* ë°°ë„ˆì™€ í—¤ë” ê²¹ì¹¨ ë°©ì§€ + ì•„ë˜ ì½˜í…ì¸  ì—¬ìœ  */
        #banner {
            margin-top: 80px;
            margin-bottom: 4em;
            position: relative;
            z-index: 1;
        }

        .fade {
            animation-name: fade;
            animation-duration: 1s;
        }

        @keyframes fade {
            from {
                opacity: 0.4;
            }

            to {
                opacity: 1;
            }
        }

        .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: #000000;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .dot.active {
            background-color: #ffffff;
        }

        .dots-container {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 100%;
            z-index: 10;
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘: AppBar ìˆ¨ê¸°ê³  ì—¬ë°± ì¡°ì • */
        #mobile-logo {
            display: none;
            position: fixed;
            top: 1em;
            left: 1em;
            font-size: 1.2em;
            font-weight: bold;
            color: #000 !important;
            text-decoration: none;
            z-index: 2000;
            background: white;
            padding: 0.3em 0.6em;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        @media screen and (max-width: 3840px) and (min-width: 1024px) {
            .wrapper.style1 {
                padding-top: 6em !important;
            }
        }

        @media screen and (max-width: 1024px) {
            #header {
                display: none !important;
            }

            .dots-container {
                bottom: 15px;
            }

            #banner {
                margin-bottom: 6em;
                /* ì—¬ìœ  ìˆê²Œ */
            }

            #mobile-logo {
                display: block !important;
            }

            #logo,
            #logo img {
                display: none !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* í˜¹ì‹œ ë‹¤ë¥¸ ìœ„ì¹˜ì—ì„œ logo.jpgê°€ ë¶ˆë ¤ì˜¤ëŠ” ê²ƒê¹Œì§€ ì œê±° */
            img[src*="logo.jpg"] {
                display: none !important;
            }
        }

        @media screen and (max-width: 1024px) {
            #banner {
                margin-bottom: 1em !important;
            }

            .wrapper.style1 {
                padding-top: 1em !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* .box.highlight ì „ì²´ë¥¼ ì™¼ìª½ ì •ë ¬ë¡œ ë¶™ì´ê¸° */
            .box.highlight {
                text-align: left !important;
                margin-left: 0 !important;
                padding-left: 0 !important;
            }

            /* ì „ì²´ ì»¨í…Œì´ë„ˆ ì—¬ë°± ì¤„ì´ê¸° */
            .wrapper.style1>.container {
                padding-left: 3em !important;
                padding-right: 1em !important;
            }

            /* ë‚´ë¶€ col ì„¹ì…˜ì˜ ì—¬ë°±ë„ ìµœì†Œí™” */
            .row.gtr-200>section {
                padding-left: 0 !important;
                padding-right: 0 !important;
            }
        }

        @media screen and (max-width: 1024px) {

            /* í•˜ì´ë¼ì´íŠ¸ ë°•ìŠ¤ ì•ˆìª½ í…ìŠ¤íŠ¸ ì™¼ìª½ ì •ë ¬ */
            .box.highlight {
                text-align: left !important;
            }


            /* ì•„ì´ì½˜ ìœ„ì¹˜ë„ ì™¼ìª½ìœ¼ë¡œ */
            .box.highlight .icon {
                margin: 0 0 1em 0;
                display: inline-block;
                float: left;
            }

            .box.highlight h3,
            .box.highlight p {
                margin-left: 6em;
                /* ì•„ì´ì½˜ ì˜†ìœ¼ë¡œ ë°€ê¸° (ì ì ˆíˆ ì¡°ì • ê°€ëŠ¥) */
            }
        }

        #login-wrapper {
            margin-top: 120px;
            text-align: center;
            padding: 3em 1em;
        }

        #login-wrapper h2 {
            font-size: 2em;
            margin-bottom: 1em;
        }

        .kakao-button {
            background-color: #FEE500;
            color: #000;
            font-weight: bold;
            border: none;
            padding: 1em 2em;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .kakao-button:hover {
            background-color: #f2d900;
        }

        @media screen and (max-width: 768px) {
            #login-wrapper {
                padding: 2em 1em;
            }
        }
    </style>
</head>

<body class="is-preload">
    <div id="page-wrapper">
        <div id="header" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2em;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    ">
            <div>
                <a href="index.html" id="logo">
                    <img src="images/logo.jpg" alt="ì°©í•œì†Œìƒê³µì¸ì§€ì›ë§ˆì¼“ ë¡œê³ " style="height: 80px;">
                </a>
            </div>
            <nav id="nav">
                <ul>
                    <li class="current"><a href="kakao-login.html" style="font-size: 0.85em;">ë¡œê·¸ì¸</a></li>
                    <li><a href="mypage.html" style="font-size: 0.85em;">ë§ˆì´í˜ì´ì§€</a>
                        <ul>
                            <li><a href="mypage.html">ë‚´ ì •ë³´ ë³´ê¸°</a></li>
                            <li><a class="js-myresult-link" href="owner-survey/survey-result.html">ë‚´ ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼ ë³´ê¸°</a></li>
                        </ul>
                    </li>
                    <li></li><a href="index.html">í™ˆ</a></li>
                    <li> <a href="brand.html">ë¸Œëœë“œ</a>
                        <ul>
                            <li><a href="brand.html#company-intro">íšŒì‚¬ì†Œê°œ</a></li>
                            <li><a href="brand.html#ci">íšŒì‚¬CI</a></li>
                            <li><a href="brand.html#culture">ê¸°ì—…ë¬¸í™”</a></li>
                            <li><a href="brand.html#sustainability">ì§€ì†ê°€ëŠ¥ê²½ì˜</a></li>
                            <li><a href="brand.html#roadmap">ë¡œë“œë§µ</a></li>
                        </ul>
                    </li>
                    <li><a href="left-sidebar.html">ì†”ë£¨ì…˜</a></li>
                    <li><a href="right-sidebar.html">í”„ë¡œê·¸ë¨</a></li>
                    <li><a href="two-sidebar.html">ê³ ê°ë¬¸ì˜</a></li>
                    <li><a href="no-sidebar.html">ì°©ì†Œë§ˆì¼“</a></li>
                </ul>
            </nav>
        </div>

        <section id="login-wrapper">
            <h2>ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì…</h2>
            <p>ì¹´ì¹´ì˜¤í†¡ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
            <a href="#" onclick="loginWithKakao(); return false;">
                <button class="kakao-button">ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button>
            </a>
        </section>
    </div>
    <script type="module">
        // ==== ë°°í¬ ê²½ë¡œê°€ ë„ë©”ì¸ ë£¨íŠ¸ê°€ ì•„ë‹ ë•Œë§Œ ì„¤ì • (ì˜ˆ: '/nbso') ====
        const SITE_BASE = window.__SITE_BASE_PATH || ""; // í•„ìš”ì‹œ window.__SITE_BASE_PATH = '/nbso';

        // ==== ê²°ê³¼ í˜ì´ì§€(ì„œë¸Œí´ë”) ê²½ë¡œ ====
        const RESULT_PATH = "owner-survey/survey-result.html";

        // í—¤ë”ì˜ "ë‚´ ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼ ë³´ê¸°" ë§í¬ë“¤ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
        const links = Array.from(document.querySelectorAll('a.js-myresult-link'));
        if (!links.length) { /* ë©”ë‰´ê°€ ì—†ëŠ” í˜ì´ì§€ëŠ” ë¬´ì‹œ */ }

        // ë§í¬ hrefë¥¼ ì¼ê´„ ë°˜ì˜
        function setLinksHref(uuid) {
            for (const a of links) {
                const dest = new URL(`${SITE_BASE}/${RESULT_PATH}`, `${location.origin}/`);
                if (uuid) dest.searchParams.set("uuid", uuid);
                // ì ˆëŒ€ê²½ë¡œ(href)ë¡œ ë„£ë˜, ê°™ì€ ë„ë©”ì¸ ë‚´ì—ì„œë§Œ ì‚¬ìš©
                a.href = dest.pathname + dest.search;
            }
        }

        // uuid ìš°ì„ ìˆœìœ„: â‘  URL ?uuid â‘¡ localStorage â‘¢ Firestore ìµœì‹  1ê±´
        async function resolveUUID() {
            // â‘  URL íŒŒë¼ë¯¸í„°
            const u1 = new URLSearchParams(location.search).get("uuid");
            if (u1) return u1;

            // â‘¡ localStorage
            const u2 = localStorage.getItem("surveyUUID");
            if (u2) return u2;

            // â‘¢ Firestore ì¡°íšŒ(ë¡œê·¸ì¸ëœ ê²½ìš°)
            try {
                const [{ initializeApp }, { getAuth, onAuthStateChanged }, { getFirestore, collection, query, orderBy, limit, getDocs }] =
                    await Promise.all([
                        import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"),
                        import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"),
                        import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"),
                    ]);

                // ì‚¬ì´íŠ¸ ê³µìš© Firebase ì„¤ì • ê·¸ëŒ€ë¡œ ì‚¬ìš©
                const firebaseConfig = {
                    apiKey: "AIzaSyDhL9qWkfXRskWCwYh7E1E901luw1MvIK4",
                    authDomain: "nbso-b7f41.firebaseapp.com",
                    projectId: "nbso-b7f41",
                    storageBucket: "nbso-b7f41.appspot.com",
                    messagingSenderId: "94203359555",
                    appId: "1:94203359555:web:07f9ee21d1291670363ff6",
                    measurementId: "G-YCWF8ENKC4"
                };

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);

                // onAuthStateChangedë¥¼ Promise í˜•íƒœë¡œ ëŒ€ê¸°
                const user = await new Promise((resolve) => {
                    onAuthStateChanged(auth, (u) => resolve(u), { onlyOnce: true });
                });
                if (!user) return null;

                const db = getFirestore(app);
                const q = query(
                    collection(db, `users/${user.uid}/survey_results`),
                    orderBy("createdAt", "desc"),
                    limit(1)
                );
                const snap = await getDocs(q);
                if (snap.empty) return null;

                const latestUUID = snap.docs[0].id;
                localStorage.setItem("surveyUUID", latestUUID);
                return latestUUID;
            } catch (e) {
                console.warn("uuid ì¡°íšŒ ì‹¤íŒ¨(ë¬´ì‹œ):", e);
                return null;
            }
        }

        // ë§í¬ í´ë¦­ ì‹œ, uuid ì—†ìœ¼ë©´ ë§ˆì´í˜ì´ì§€ë¡œ ìœ ë„
        function attachFallbackClick() {
            for (const a of links) {
                a.addEventListener("click", (e) => {
                    // ì´ë¯¸ uuid ë¶™ì—ˆìœ¼ë©´ ê·¸ëŒ€ë¡œ í†µê³¼
                    if (a.href.includes("uuid=")) return;

                    e.preventDefault();
                    // ë¡œê·¸ì¸/ì—°ë™/ì„¤ë¬¸ ì•ˆë‚´í•˜ê¸° ì¢‹ì€ ê³³ìœ¼ë¡œ ì´ë™
                    const my = new URL(`${SITE_BASE}/mypage.html`, `${location.origin}/`);
                    // ëŒì•„ì˜¬ ë•Œ uuid ë¶™ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ í˜„ì¬ í˜ì´ì§€ë„ ì „ë‹¬ ê°€ëŠ¥(ì˜µì…˜)
                    my.searchParams.set("from", location.pathname + location.search);
                    location.href = my.pathname + my.search;
                });
            }
        }

        // ì‹¤í–‰
        (async () => {
            attachFallbackClick();                // ë¨¼ì € í´ë¦­ ëŒ€ì•ˆ ì—°ê²°
            const uuid = await resolveUUID();     // uuid í™•ë³´ ì‹œë„
            setLinksHref(uuid);                   // í™•ë³´ë˜ë©´ ë§í¬ì— ë°˜ì˜
        })();
    </script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // âœ… Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDhL9qWkfXRskWCwYh7E1E901luw1MvIK4",
            authDomain: "nbso-b7f41.firebaseapp.com",
            projectId: "nbso-b7f41",
            storageBucket: "nbso-b7f41.appspot.com",
            messagingSenderId: "94203359555",
            appId: "1:94203359555:web:07f9ee21d1291670363ff6",
            measurementId: "G-YCWF8ENKC4"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth(); // Firebase Auth ê°ì²´ ì´ˆê¸°í™”
        // â¬‡ï¸â¬‡ï¸â¬‡ï¸ ì—¬ê¸°ì— ì¶”ê°€!
        auth.signInAnonymously()
            .then(() => console.log("âœ… Firebase ìµëª… ë¡œê·¸ì¸ ì™„ë£Œ"))
            .catch(err => console.error("âŒ ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨:", err));
        // â¬†ï¸â¬†ï¸â¬†ï¸

        // âœ… ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”
        Kakao.init("cc58d703cacde86ff1976fd723a04854"); // ì‹¤ì œ ì•± í‚¤ ì‚¬ìš©

        function loginWithKakao() {
            Kakao.Auth.login({
                // ğŸ”“ ìˆ˜ì§‘ ë²”ìœ„ í™•ëŒ€ (ì½˜ì†”ì—ì„œ ë™ì˜í•­ëª© ë“±ë¡/ìŠ¹ì¸ë˜ì–´ì•¼ ê°’ì´ ì˜µë‹ˆë‹¤)
                scope: 'profile_nickname,profile_image,account_email,gender,age_range,birthday,birthyear,phone_number',
                success: function (authObj) {
                    console.log("âœ… ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì„±ê³µ:", authObj);

                    // 1) ì¹´ì¹´ì˜¤ í”„ë¡œí•„ ì¡°íšŒ
                    Kakao.API.request({
                        url: '/v2/user/me',
                        success: async function (res) {
                            try {
                                // Firebase ì„œë²„/í´ë¼ íƒ€ì„ìŠ¤íƒ¬í”„
                                const nowClient = firebase.firestore.Timestamp.now();
                                const nowServer = firebase.firestore.FieldValue.serverTimestamp();

                                // í˜„ì¬ Firebase ì‚¬ìš©ì (ìµëª…ë¡œê·¸ì¸ ì™„ë£Œ ì „ì œ)
                                const user = auth.currentUser;
                                if (!user) {
                                    alert('ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                                    return;
                                }
                                const firebaseUid = user.uid;

                                // ì„¤ë¬¸ ê²°ê³¼ ë¬¸ì„œ í‚¤ (ìˆìœ¼ë©´ ë§í¬ ì—…ë°ì´íŠ¸)
                                const surveyUUID =
                                    localStorage.getItem('surveyUUID') ||
                                    new URLSearchParams(location.search).get('uuid') ||
                                    null;

                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ì‘ë‹µ íŒŒì‹± (ë„ ì•ˆì „)
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                const kakaoId = String(res?.id ?? '');
                                const account = res?.kakao_account ?? {};
                                const profile = account?.profile ?? {};

                                const nickname = profile?.nickname ?? res?.properties?.nickname ?? '';
                                const email = account?.email ?? null;
                                const gender = account?.gender ?? null;            // 'male' | 'female' | null
                                const ageRange = account?.age_range ?? null;         // ì˜ˆ: '20~29'
                                const birthday = account?.birthday ?? null;          // 'MMDD'
                                const birthyear = account?.birthyear ?? null;         // 'YYYY' (ìŠ¹ì¸ í•„ìš”)
                                const phoneNumber = account?.phone_number ?? null;      // E.164 (ìŠ¹ì¸ í•„ìš”)
                                const profileImageUrl = profile?.profile_image_url
                                    ?? res?.properties?.profile_image
                                    ?? profile?.thumbnail_image_url
                                    ?? null;

                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ì €ì¥ 1) ì¤‘ì•™ í”„ë¡œí•„: users/{uid}
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                await db.collection('users').doc(firebaseUid).set({
                                    uid: firebaseUid,
                                    provider: 'kakao',
                                    kakaoId,
                                    displayName: nickname || '',
                                    email,
                                    gender,
                                    ageRange,
                                    birthday,
                                    birthyear,
                                    phoneNumber,
                                    profileImageUrl,
                                    last_login_timestamp: nowServer,
                                    updatedAt: nowServer,
                                    // (ì´ˆê¸° ìƒì„± ì‹œê°ì´ í•„ìš”í•˜ë©´ í´ë¼ íƒ€ì„ë„ í•¨ê»˜ ì €ì¥)
                                    created_timestamp: nowClient
                                }, { merge: true });

                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ì €ì¥ 2) ë¯¼ê°/ì›ë³¸ ìŠ¤ëƒ…ìƒ·: users/{uid}/private/kakao
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                await db.doc(`users/${firebaseUid}/private/kakao`).set({
                                    kakaoId,
                                    email,
                                    nickname,
                                    gender,
                                    age_range: ageRange,
                                    birthday,
                                    birthyear,
                                    phone_number: phoneNumber,
                                    profile_image: profileImageUrl,
                                    connectedAt: nowServer,
                                    // í•„ìš” ì‹œ ì›ë³¸ ì „ì²´ ë³´ê´€
                                    raw: res
                                }, { merge: true });

                                // (ì„ íƒ) ë™ì˜í•œ scope ëª©ë¡ë„ ê¸°ë¡í•´ë‘ë©´ ì¶”í›„ ìœ ìš©
                                try {
                                    Kakao.API.request({
                                        url: '/v2/user/scopes',
                                        success: async function (scopesRes) {
                                            const consentedScopes = (scopesRes?.scopes ?? [])
                                                .filter(s => s?.agreed)
                                                .map(s => s?.id);
                                            await db.collection('users').doc(firebaseUid).set({
                                                consentedScopes,
                                                scopesUpdatedAt: nowServer
                                            }, { merge: true });
                                        },
                                        fail: function (e) {
                                            console.warn('ë™ì˜ scope ì¡°íšŒ ì‹¤íŒ¨(ë¬´ì‹œ ê°€ëŠ¥):', e);
                                        }
                                    });
                                } catch (e) {
                                    console.warn('ë™ì˜ scope ì¡°íšŒ ìƒëµ/ì‹¤íŒ¨:', e);
                                }

                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                // ì €ì¥ 3) ì„¤ë¬¸ ê²°ê³¼ ë¬¸ì„œ ë§í¬ ê°±ì‹  (ìˆì„ ë•Œë§Œ)
                                // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                if (surveyUUID) {
                                    await db.doc(`users/${firebaseUid}/survey_results/${surveyUUID}`).set({
                                        kakaoLinked: true,
                                        linkedAt: nowServer,
                                        kakaoUid: kakaoId,
                                        kakaoEmail: email || '',
                                        kakaoNickname: nickname || '',
                                        // TTL í•´ì œ
                                        expiresAt: null
                                    }, { merge: true });
                                }

                                console.log('âœ… Firestore ì €ì¥ ì™„ë£Œ');
                                // í›„ì† ì´ë™ (í•„ìš”ì‹œ uuid ì „ë‹¬)
                                // window.location.href = `kakao-login-success.html?uuid=${surveyUUID ?? ''}`;
                                alert('ì¹´ì¹´ì˜¤ ì—°ë™ ë° ì •ë³´ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');

                            } catch (error) {
                                console.error('âŒ ì¹´ì¹´ì˜¤ ì—°ë™ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                                alert('ì¹´ì¹´ì˜¤ ì—°ë™ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error?.message);
                            }
                        },
                        fail: function (error) {
                            console.error('âŒ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:', error);
                            alert('ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        }
                    });
                },
                fail: function (err) {
                    console.error("âŒ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨:", err);
                    alert("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + JSON.stringify(err));
                }
            });
        }
    </script>
</body>

</html>